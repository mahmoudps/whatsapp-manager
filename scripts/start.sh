#!/bin/bash
set -euo pipefail

# ุณูุฑูุจุช ุชุดุบูู WhatsApp Manager

echo "๐ ุจุฏุก ุชุดุบูู WhatsApp Manager..."

# ุงูุชุฃูุฏ ูู ูุฌูุฏ ููู .env
if [ ! -f .env ]; then
  echo "โ ููู .env ุบูุฑ ููุฌูุฏ"
  echo "๐ก ูุตูุญุฉ: ูู ุจุชุดุบูู 'npm run setup' ูุฅุนุฏุงุฏ ุงูุชุทุจูู"
  exit 1
fi

# ุงูุชุฃูุฏ ูู ูุฌูุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
DB_PATH=$(grep DATABASE_PATH .env | cut -d '=' -f2)
if [ -z "$DB_PATH" ]; then
  DB_PATH="./data/whatsapp_manager.db"
fi

if [ ! -f "$DB_PATH" ]; then
  echo "โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ููุฌูุฏุฉ ูู $DB_PATH"
  echo "๐ก ูุตูุญุฉ: ูู ุจุชุดุบูู 'npm run init-db' ูุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช"
  exit 1
fi

# ุงูุชุฃูุฏ ูู ุชุซุจูุช ุงูุชุจุนูุงุช
if [ ! -d "node_modules" ]; then
  echo "โ ุงูุชุจุนูุงุช ุบูุฑ ูุซุจุชุฉ"
  echo "๐ก ูุตูุญุฉ: ูู ุจุชุดุบูู 'npm install' ูุชุซุจูุช ุงูุชุจุนูุงุช"
  exit 1
fi

# ุงูุชุฃูุฏ ูู ุจูุงุก ุงูุชุทุจูู
if [ ! -d ".next" ]; then
  echo "โ๏ธ ุงูุชุทุจูู ุบูุฑ ูุจูู"
  echo "๐ ุฌุงุฑู ุจูุงุก ุงูุชุทุจูู..."
  npm run build
fi

# ุชุดุบูู ุงูุชุทุจูู
echo "โ ุฌุงุฑู ุชุดุบูู ุงูุชุทุจูู..."
npm start
